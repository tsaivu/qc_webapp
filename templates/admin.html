<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n tr·ªã h·ªá th·ªëng QC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light p-4">

  <div class="container">
    <h2 class="mb-4">üõ† Trang qu·∫£n tr·ªã h·ªá th·ªëng QC</h2>

    <!-- X√ìA D·ªÆ LI·ªÜU -->
    <div class="card mb-4">
      <div class="card-header bg-danger text-white">X√≥a d·ªØ li·ªáu QC trong kho·∫£ng th·ªùi gian</div>
      <div class="card-body">
        <form id="delete-form">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">T·ª´ ng√†y:</label>
              <input type="datetime-local" class="form-control" id="delete-start" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">ƒê·∫øn ng√†y:</label>
              <input type="datetime-local" class="form-control" id="delete-end" required>
            </div>
          </div>
          <button type="submit" class="btn btn-danger mt-3">X√≥a d·ªØ li·ªáu</button>
        </form>
      </div>
    </div>

    <!-- NH√ÇN VI√äN -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Nh√¢n vi√™n</div>
      <div class="card-body">
        <form id="user-form">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">T√™n nh√¢n vi√™n:</label>
              <input type="text" class="form-control" id="user-name" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">M·∫≠t kh·∫©u:</label>
              <input type="password" class="form-control" id="user-pass" required>
            </div>
            <div class="col-md-2">
              <label class="form-label">B·ªô ph·∫≠n:</label>
              <select class="form-select" id="user-dept">
                <option>Tr·ªôn</option>
                <option>Th·ªïi/In</option>
                <option>C·∫Øt</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Vai tr√≤:</label>
              <select class="form-select" id="user-role">
                <option>nhanvien</option>
                <option>qc</option>
                <option>quanly</option>
                <option>admin</option>
              </select>
            </div>
          </div>
          <div class="d-flex align-items-center mt-3">
            <button type="submit" class="btn btn-success me-3">T·∫°o nh√¢n vi√™n</button>
            <input type="file" id="import-users-file" accept=".csv" class="form-control w-auto me-2">
            <button id="import-users-btn" class="btn btn-warning" type="button">üì• Import CSV</button>
          </div>
        </form>
      </div>
    </div>

    <!-- S·∫¢N PH·∫®M -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white">S·∫£n ph·∫©m</div>
      <div class="card-body">
        <form id="product-form">
          <div class="row g-3 align-items-end">
            <div class="col-md-6">
              <label class="form-label">T√™n s·∫£n ph·∫©m:</label>
              <input type="text" class="form-control" id="product-name" required>
            </div>
            <div class="col-md-6 d-flex">
              <button type="submit" class="btn btn-success me-3">T·∫°o s·∫£n ph·∫©m</button>
              <input type="file" id="import-products-file" accept=".csv" class="form-control w-auto me-2">
              <button id="import-products-btn" class="btn btn-info" type="button">üì• Import CSV</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- M√ÅY -->
    <div class="card mb-5">
      <div class="card-header bg-secondary text-white">M√°y</div>
      <div class="card-body">
        <form id="machine-form">
          <div class="row g-3 align-items-end">
            <div class="col-md-6">
              <label class="form-label">T√™n m√°y:</label>
              <input type="text" class="form-control" id="machine-name" required>
            </div>
            <div class="col-md-6 d-flex">
              <button type="submit" class="btn btn-secondary me-3">T·∫°o m√°y</button>
              <input type="file" id="import-machines-file" accept=".csv" class="form-control w-auto me-2">
              <button id="import-machines-btn" class="btn btn-dark" type="button">üì• Import CSV</button>
            </div>
          </div>
        </form>
      </div>
    </div>

  </div>

  <!-- SCRIPT -->
  <script>
    // X√ìA QC
    document.getElementById('delete-form').onsubmit = async (e) => {
      e.preventDefault();
      const res = await fetch('/admin/delete-qc-data', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          start: document.getElementById('delete-start').value,
          end: document.getElementById('delete-end').value
        })
      });
      alert(await res.text());
    };

    // T·∫†O NH√ÇN VI√äN
    document.getElementById('user-form').onsubmit = async (e) => {
      e.preventDefault();
      const res = await fetch('/admin/add-user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: document.getElementById('user-name').value,
          password: document.getElementById('user-pass').value,
          department: document.getElementById('user-dept').value,
          role: document.getElementById('user-role').value
        })
      });
      alert(await res.text());
    };

    // IMPORT NH√ÇN VI√äN
document.getElementById('import-users-btn').onclick = async () => {
  const fileInput = document.getElementById('import-users-file');
  const file = fileInput.files[0];

  if (!file) {
    alert("Vui l√≤ng ch·ªçn file CSV tr∆∞·ªõc khi import.");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch('/admin/import-users', {
      method: 'POST',
      body: formData
    });

    if (!res.ok) {
      const errText = await res.text();
      throw new Error(`${res.status}: ${errText}`);
    }

    const result = await res.text();
    alert(result);
  } catch (err) {
    alert("L·ªói khi import: " + err.message);
  }
};


    // T·∫†O S·∫¢N PH·∫®M
    document.getElementById('product-form').onsubmit = async (e) => {
      e.preventDefault();
      const res = await fetch('/admin/add-product', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: document.getElementById('product-name').value })
      });
      alert(await res.text());
    };

    // IMPORT S·∫¢N PH·∫®M
document.getElementById('import-products-btn').onclick = async () => {
  const fileInput = document.getElementById('import-products-file');
  const file = fileInput.files[0];

  if (!file) {
    alert("Vui l√≤ng ch·ªçn file CSV tr∆∞·ªõc khi import.");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch('/admin/import-products', {
      method: 'POST',
      body: formData
    });

    if (!res.ok) {
      const errText = await res.text();
      throw new Error(`${res.status}: ${errText}`);
    }

    const result = await res.text();
    alert(result);
  } catch (err) {
    alert("L·ªói khi import: " + err.message);
  }
};


    // T·∫†O M√ÅY
    document.getElementById('machine-form').onsubmit = async (e) => {
      e.preventDefault();
      const res = await fetch('/admin/add-machine', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: document.getElementById('machine-name').value })
      });
      alert(await res.text());
    };

    // IMPORT M√ÅY
document.getElementById('import-machines-btn').onclick = async () => {
  const fileInput = document.getElementById('import-machines-file');
  const file = fileInput.files[0];

  if (!file) {
    alert("Vui l√≤ng ch·ªçn file CSV tr∆∞·ªõc khi import.");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch('/admin/import-machines', {
      method: 'POST',
      body: formData
    });

    if (!res.ok) {
      const errText = await res.text();
      throw new Error(`${res.status}: ${errText}`);
    }

    const result = await res.text();
    alert(result);
  } catch (err) {
    alert("L·ªói khi import: " + err.message);
  }
};

  </script>

</body>
</html>
